import jakarta.persistence.EntityManager;
import jakarta.persistence.EntityManagerFactory;
import jakarta.persistence.Persistence;
import team3.dao.AbbonamentoDAO;

import java.time.LocalDate;
import java.util.Scanner;

public class Application {

    private static Scanner scanner = new Scanner(System.in);

    private static EntityManager em;
    private static AbbonamentoDAO abbonamentoDAO;

    public static void main(String[] args) {

        // ENTITY MANAGER
        EntityManagerFactory emf = Persistence.createEntityManagerFactory("NOME_PERSISTENCE_UNIT");
        em = emf.createEntityManager();

        // DAO ABBONAMENTO (la tua parte)
        abbonamentoDAO = new AbbonamentoDAO(em);

        boolean running = true;

        while (running) {
            System.out.println("AZIENDA DI TRASPORTO PUBBLICO");
            System.out.println("1 - Utente");
            System.out.println("2 - Amministratore");
            System.out.println("0 - Esci");
            System.out.print("Scelta: ");

            int scelta = scanner.nextInt();
            scanner.nextLine();

            switch (scelta) {
                case 1:
                    menuUtente();
                    break;
                case 2:
                    menuAmministratore();
                    break;
                case 0:
                    running = false;
                    System.out.println("Uscita dal sistema, arrivederci e a presto!");
                    break;
                default:
                    System.out.println("Scelta non valida, ritenta.");
            }
        }

        em.close();
        emf.close();
        scanner.close();
    }

    // =========================
    // MENU UTENTE (come schema)
    // =========================
    private static void menuUtente() {
        boolean back = false;

        while (!back) {

            // dove ti trovi?
            // 1) distributore automatico
            // 2) rivenditore autorizzato
            // poi: cosa vuoi fare? (biglietto / abbonamento / verifica validità)

            System.out.println("UTENTE");
            System.out.println("Dove ti trovi?");
            System.out.println("1 - Distributore automatico");
            System.out.println("2 - Rivenditore autorizzato");
            System.out.println("0 - Torna indietro");
            System.out.print("Scelta: ");

            int luogo = scanner.nextInt();
            scanner.nextLine();

            switch (luogo) {
                case 1:
                    // sei in distributore automatico
                    // ora chiedi cosa vuoi fare (biglietto / abbonamento / verifica validità)
                    menuAzioniUtente();
                    break;
                case 2:
                    // sei in rivenditore autorizzato
                    // ora chiedi cosa vuoi fare (biglietto / abbonamento / verifica validità)
                    menuAzioniUtente();
                    break;
                case 0:
                    back = true;
                    break;
                default:
                    System.out.println("Scelta non valida, ritenta!");
            }
        }
    }

    // sottomenù: cosa vuoi fare? (come schema utente)
    private static void menuAzioniUtente() {
        boolean back = false;

        while (!back) {
            System.out.println("Cosa vuoi fare?");
            System.out.println("1 - Fai biglietto");
            System.out.println("2 - Fai abbonamento");
            System.out.println("3 - Verifica validita abbonamento");
            System.out.println("0 - Torna indietro");
            System.out.print("Scelta: ");

            int scelta = scanner.nextInt();
            scanner.nextLine();

            switch (scelta) {
                case 1:
                    // schema: vuoi biglietto? -> genera biglietto
                    // ...
                    break;
                case 2:
                    // schema: vuoi abbonamento? -> genera abbonamento
                    // ...
                    break;
                case 3:
                    // schema: inserisci numero tessera -> valido/non valido
                    // se non valido: vuoi rinnovarla? si/no
                    // se valido: vuoi abbonamento? -> genera abbonamento
                    // ...
                    break;
                case 0:
                    back = true;
                    break;
                default:
                    System.out.println("Scelta non valida, ritenta!");
            }
        }
    }

    // =================================
    // MENU AMMINISTRATORE (come schema)
    // =================================
    private static void menuAmministratore() {
        boolean back = false;

        while (!back) {

            // admin: cosa vuoi visualizzare?
            // biglietti / tessere emesse / mezzi / extra distributori / aggiungere cose
            // + tua voce già corretta: verifica abbonamento per tessera

            System.out.println("ADMIN");
            System.out.println("Cosa vuoi visualizzare?");
            System.out.println("1 - Biglietti");
            System.out.println("2 - Verifica abbonamento per tessera");
            System.out.println("3 - Tessere emesse");
            System.out.println("4 - Mezzi");
            System.out.println("5 - EXTRA: lista distributori attivi/non attivi");
            System.out.println("6 - Aggiungere cose");
            System.out.println("0 - Torna indietro");
            System.out.print("Scelta: ");

            int scelta = scanner.nextInt();
            scanner.nextLine();

            switch (scelta) {
                case 1:
                    // apre sottomenù biglietti (come schema admin)
                    // ...
                    break;
                case 2:
                    // già collegato alla tua parte (DAO abbonamento)
                    verificaAbbonamentoAdmin();
                    break;
                case 3:
                    // schema: tessere emesse
                    // ...
                    break;
                case 4:
                    // apre sottomenù mezzi (periodi servizio/manutenzione, percorrenze/tempo medio)
                    // ...
                    break;
                case 5:
                    // schema extra: lista distributori attivi/non attivi
                    // ...
                    break;
                case 6:
                    // schema: aggiungere cose (creazioni/aggiunte varie)
                    // ...
                    break;
                case 0:
                    back = true;
                    break;
                default:
                    System.out.println("Scelta non valida, ritenta!");
            }
        }
    }

    // ======================
    // METODI UTENTE (bozza)
    // ======================

    private static void metodoUtente1() {
        // ...
    }

    private static void metodoUtente2() {
        // ...
    }

    private static void metodoUtente3() {
        // ...
    }

    // ==============================
    // METODI AMMINISTRATORE (bozza)
    // ==============================

    private static void metodoAdmin1() {
        // ...
    }

    // ============================
    // SOLO PER LA TUA PARTE (DAO)
    // ============================
    private static void verificaAbbonamentoAdmin() {

        // admin: verifica rapida abbonamento per codice tessera (come consegna)
        // chiede codice tessera
        // controlla se valido in base alla data odierna
        // stampa valido / non valido

        System.out.println("Inserisci codice tessera:");
        String codiceTessera = scanner.nextLine();

        LocalDate oggi = LocalDate.now();

        boolean valido = abbonamentoDAO.isAbbonamentoValido(codiceTessera, oggi);

        if (valido) {
            System.out.println("Abbonamento VALIDO");
        } else {
            System.out.println("Abbonamento NON valido o assente");
        }
    }

    private static void metodoAdmin3() {
        // ...
    }

    private static void metodoAdmin4() {
        // ...
    }

    private static void metodoAdmin5() {
        // ...
    }

    private static void metodoAdmin6() {
        // ...
    }
}


